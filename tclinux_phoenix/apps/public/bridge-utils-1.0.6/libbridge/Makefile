KERNEL_HEADERS=-I$(KERNEL_HEADER)

AR=ar
RANLIB=$(CROSS)ranlib

#CC=mips-linux-gcc
CFLAGS = -Wall -g $(KERNEL_HEADERS)
ifeq ($(strip $(TCSUPPORT_3_18_21_KERNEL)),1)
     CFLAGS+= -DTCSUPPORT_3_18_21_KERNEL
endif
ifeq ($(TCSUPPORT_IGMP_SNOOPING),1)
     CFLAGS+= -DTCSUPPORT_IGMP_SNOOPING
     CFLAGS+= -DCONFIG_IGMP_SNOOPING
ifneq ($(strip $(TCSUPPORT_3_18_21_KERNEL)),)
     CFLAGS+= -DCONFIG_BRIDGE_IGMP_SNOOPING
endif
     ifeq ($(TCSUPPORT_IGMPSNOOPING_ENHANCE),1)
     CFLAGS+= -DTCSUPPORT_IGMPSNOOPING_ENHANCE
     CFLAGS+= -DCONFIG_BRIDGE_IGMP_SNOOPING
     endif
endif
ifeq ($(TCSUPPORT_IGMP_SNOOPING_V3),1)
     CFLAGS+= -DTCSUPPORT_IGMP_SNOOPING_V3
endif


ifeq ($(TCSUPPORT_MLD_SNOOPING),1)
     CFLAGS+= -DTCSUPPORT_MLD_SNOOPING
     CFLAGS+= -DCONFIG_MLD_SNOOPING
endif

ifeq ($(TCSUPPORT_IGMP_SET_GROUP),1)
     CFLAGS+= -DTCSUPPORT_IGMP_SET_GROUP
endif

prefix=/usr/local
exec_prefix=${prefix}
includedir=${prefix}/include
libdir=${exec_prefix}/lib

libbridge_SOURCES= \
	libbridge_devif.c \
	libbridge_if.c \
	libbridge_init.c \
	libbridge_misc.c 

libbridge_OBJECTS=$(libbridge_SOURCES:.c=.o)

all:	libbridge.a

install: libbridge.a
	mkdir -p $(DESTDIR)$(includedir)
	install -m 644 libbridge.h $(DESTDIR)$(includedir)
	mkdir -p $(DESTDIR)$(libdir)
	install -m 644 libbridge.a $(DESTDIR)$(libdir)


clean:
	rm -f *.o libbridge.a

libbridge.a:	$(libbridge_OBJECTS)
	$(AR) rcs $@ $(libbridge_OBJECTS)
	$(RANLIB) $@

%.o: %.c libbridge.h libbridge_private.h
	$(CC) $(CFLAGS) $(INCLUDE) -c $<

libbridge_compat.o:	libbridge_compat.c if_index.c
	$(CC) $(CFLAGS) -c libbridge_compat.c

